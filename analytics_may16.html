<!DOCTYPE html>
<meta charset="utf-8">
<body bgcolor="#C2C2F0">
<body background="https://www.dropbox.com/s/pwstpuv0pi62z8f/background2.jpg?dl=1">
<style>

html, body {
  width: 90%;
  height: 90%;
  margin: 0;
  padding: 0;

  }

.node circle {
  cursor: pointer;
  stroke: none;
  stroke-width: 1.5px;
}

.node text {
  font: 18px;
  font-family: "monospace";
  pointer-events: none;
  padding: 30px;
}

line.link {
  fill: none;
  stroke: #6C6F69;
  stroke-width: 1.3px;
}

</style>

<body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
<script>

var width = 750, height = 400;


//function resize() {
//    width = window.innerWidth, height = window.innerHeight;
//    svg.attr("width", width).attr("height", height);
//    force.size([width, height]).resume();
//} 
	
var	radius=0.1;

var ldist=50;

var svg = d3.select("#viz").append("svg")
            .attr("id", "playgraph")
             //better to keep the viewBox dimensions with variables
            .attr("viewBox", "0 0 " + width + " " + height )
            .attr("preserveAspectRatio", "xMidYMid meet");
 			
			
var emptyURL = "https://www.dropbox.com/s/76u6lx8fm7n7xel/empty2.png?dl=1";
	
var radius = d3.scale.sqrt()
    .range([0, 3]);
	

var force = d3.layout.force()
	.linkStrength(0.3)
	.charge(-1500)
    .gravity(.2)
    .size([width, height])
	.linkDistance(function(d) {ldist=30;
	return ldist;})
	.start();

	

//var allnode =  flatten(root);
//for (var i=0;i<allnode.length;i++){click(allnode[i])};

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

var link = svg.selectAll(".link"),
    node = svg.selectAll(".node");

root={
 "name": "analytics", "ll":2,"img":emptyURL,
 "children": [
  {
   "name": "clive", "group":"#3D991F", "ll":1,"img":emptyURL,
   "children": [
    {
     "name": "specialisms", "group":"#3D991F","given":1, "size": 7000,"img":emptyURL,
     "children": [
	  {"name": "conjoint", "group":"#3D991F", "size": 4000, "ll":4,"img":emptyURL},
      {"name": "segmentation", "group":"#3D991F", "size": 4000, "ll":4,"img":emptyURL},
      {"name": "forecasting", "group":"#3D991F", "size": 4000, "ll":4,"img":emptyURL},
      {"name": "path models", "group":"#3D991F", "size": 4000, "ll":4,"img":emptyURL},
      {"name": "data forensics", "group":"#3D991F", "size": 4000, "ll":4,"img":emptyURL}
     ]
    },
    {
     "name": "\f \f \f \f Clive Frostick","jobtitle":"\f \f \f \f Senior Director", "group":"#3D991F","size":1000, "img":"https://www.dropbox.com/s/41uex4w63gyxgbs/clive.png?dl=1",
     "children": [
      {"name": "clive.frostick@ipsos.com", "group":"#3D991F", "size": 4000, "ll":3,"img":emptyURL},
      {"name": "+44 0208 861 8755", "group":"#3D991F", "size": 4000, "ll":3,"img":emptyURL}
     ]
    }
   ]
  },
  {"name": "pawel", "group":"#CD9B1D", "ll":10,"img":emptyURL,"children":[
	{
     "name": "specialisms", "group":"#CD9B1D","given":1, "size": 7000,"img":emptyURL,
     "children": [
      {"name": "statistical programming", "group":"#CD9B1D", "size": 4000, "ll":4,"img":emptyURL},
      {"name": "econometrics", "group":"#CD9B1D", "size": 4000, "ll":4,"img":emptyURL},
      {"name": "spatial analysis", "group":"#CD9B1D", "size": 4000, "ll":4,"img":emptyURL},
      {"name": "data visualisation", "group":"#CD9B1D", "size": 4000, "ll":4,"img":emptyURL},
      {"name": "panel data", "group":"#CD9B1D", "size": 4000, "ll":4,"img":emptyURL}
     ]
    },
	{"name": "\f \f \f \f Pawel Paluchowski","jobtitle":"\f \f \f \f Statistician", "size": 3534, "ll":4,"img":"https://www.dropbox.com/s/h6rubumcq726y8e/pawel.png?dl=1",
	"children": [
	  {"name": "pawel.paluchowski@ipsos.com", "group":"#CD9B1D", "size": 4000, "ll":3,"img":emptyURL},
      {"name": "+44 203 059 4896", "group":"#CD9B1D", "size": 4000, "ll":3,"img":emptyURL}
     ]
	}
  ]
  },
  {"name": "zoran", "group":"#343480", "ll":5,"img":emptyURL,"children":[
	{
     "name": "specialisms", "group":"#343480","given":1, "size": 7000,"img":emptyURL,
     "children": [
	  {"name": "segmentation", "group":"#343480", "size": 4000, "ll":4,"img":emptyURL},
      {"name": "key drivers analysis", "group":"#343480", "size": 4000, "ll":4,"img":emptyURL},
      {"name": "decision trees", "group":"#343480", "size": 4000, "ll":4,"img":emptyURL}
     ]
    },
	{"name": "\f \f \f \f Zoran Orlic","jobtitle":"\f \f \f \f Senior Data Analyst", "size": 3534, "ll":4,"img":"https://www.dropbox.com/s/br38juclxtrxtdj/zoran.png?dl=1",
	"children": [
      {"name": "zoran.orlic@ipsos.com", "group":"#343480", "size": 4000, "ll":3,"img":emptyURL},
      {"name": "+44 207 347 3939", "group":"#343480", "size": 4000, "ll":3,"img":emptyURL}
    ]
   }
  ]
  },
  {"name": "anna", "group":"#6B0024", "ll":0,"img":emptyURL,"children":[
    {
     "name": "specialisms", "group":"#6B0024","given":1, "size": 7000,"img":emptyURL,
     "children": [
      {"name": "media & advertising", "group":"#6B0024", "size": 4000, "ll":4,"img":emptyURL},
      {"name": "A/B testing", "group":"#6B0024", "size": 4000, "ll":4,"img":emptyURL},
      {"name": "causal inference", "group":"#6B0024", "size": 4000, "ll":4,"img":emptyURL},
	  {"name": "econometrics", "group":"#6B0024", "size": 4000, "ll":4,"img":emptyURL},
	  {"name": "social science research methods", "group":"#6B0024", "size": 4000, "ll":4,"img":emptyURL}
     ]
    },
	{"name": "\f \f \f \f Anna Sperati","jobtitle":"\f \f \f \f Statistician", "size": 3534, "ll":4,"img":"https://www.dropbox.com/s/4ubyjc70ctn871w/anna.png?dl=1",
	"children": [
	  {"name": "anna.sperati@ipsos.com", "group":"#6B0024", "size": 4000, "ll":3,"img":emptyURL},
      {"name": "+44 203 059 5543", "group":"#6B0024", "size": 4000, "ll":3,"img":emptyURL}
     ]
    }
   ]
  },
  {"name": "sarah", "group":"#007A7A", "ll":1,"img":emptyURL,"children":[
	{
     "name": "specialisms", "group":"#007A7A","given":1, "size": 7000,"img":emptyURL,
     "children": [
	  {"name": "weighting & sampling", "group":"#007A7A", "size": 4000, "ll":4,"img":emptyURL},
      {"name": "matching & evaluation", "group":"#007A7A", "size": 4000, "ll":4,"img":emptyURL},
      {"name": "time series modelling", "group":"#007A7A", "size": 4000, "ll":4,"img":emptyURL},
	  {"name": "social science research methods", "group":"#007A7A", "size": 4000, "ll":4,"img":emptyURL}
     ]
    },
	{"name": "\f \f \f \f Sarah Tipping","jobtitle":"\f \f \f \f Statistician", "size": 3534, "ll":4,"img":"https://www.dropbox.com/s/p8k6e3k82w8ipuf/sarah.png?dl=1",
	"children": [
      {"name": "sarah.tipping@ipsos.com", "group":"#007A7A", "size": 4000, "ll":3,"img":emptyURL},
      {"name": "+44 207 347 3148", "group":"#007A7A", "size": 4000, "ll":3,"img":emptyURL}
     ]
	}	 
   ]
 }
 ]
};

// root.children.forEach(toggleAll);
update();

var collapseMe = flatten(root);
for(var j = 0; j< collapseMe.length; j++){toggle(collapseMe[j])};
//click(root.children[1]);
update(root);

function update() {
  var nodes = flatten(root),
      links = d3.layout.tree().links(nodes);
	

  // Restart the force layout.
  force
      .nodes(nodes)
      .links(links)
	  .on("tick", tick)
      .start();
  
	
  // Update links.
  link = link.data(links, function(d) { return d.target.id; });

  link.exit().remove();

  link.enter().insert("line", ".node")
      .attr("class", "link")
	  .attr("x1", function(d) { return d.source.x; })
      .attr("y1", function(d) { return d.source.y; })
      .attr("x2", function(d) { return d.target.x; })
      .attr("y2", function(d) { return d.target.y; });

  // Update nodes.
  node = node.data(nodes, function(d) { return d.id; });

  node.exit().remove();
 

  var nodeEnter = node.enter().append("g")
      .attr("class", "node")
      .on("click", click)
	  .style("fill", function(d) { return d.group; })
      .call(force.drag);

  nodeEnter.append("circle")
      .attr("r", function(d) { return Math.sqrt(d.size) / 10 || 10; });
	  
  // Append images
var images = nodeEnter.append("svg:image")
      .attr("xlink:href",  function(d) {return d.img;})
		.attr("class", "circle")
       .attr("x", function(d) { return -40;})
       .attr("y", function(d) { return -40;})
       .attr("height", 80)
       .attr("width", 80);
		

 
	  

  nodeEnter.append("text")
      .attr("dy", "0.35em")
	  .attr("dx", ".7em")
	  .style("font-family", "monospace")
      .attr("font-size", "16px")
	  .attr("fill", "#3B3B3B")
      .text(function(d) { return d.name; });
	  
  nodeEnter.append("text")
      .attr("dy", "1.5em")
	  .attr("dx", "1.6em")
	  .style("font-family", "monospace")
      .attr("font-size", "12px")
	  .attr("fill", "#3B3B3B")
      .text(function(d) { return d.jobtitle; });

  node.select("circle")
      .style("fill", function (d) { return d.group; });
}

function tick() {
node.attr("cx", function(d) { return d.x = Math.max(15, Math.min(width - 15, d.x)); })
    .attr("cy", function(d) { return d.y = Math.max(15, Math.min(height - 15, d.y)); });

link.attr("x1", function(d) { return d.source.x; })
    .attr("y1", function(d) { return d.source.y; })
    .attr("x2", function(d) { return d.target.x; })
    .attr("y2", function(d) { return d.target.y; });

node.attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });
	 

  

}

function color(d) {
  return d._children ? "#3182bd" // collapsed package
      : d.children ? "#c6dbef" // expanded package
      : "#fd8d3c"; // leaf node
}


// Toggle children on click.
function click(d) {
  if (d3.event.defaultPrevented) return; // ignore drag
  if (d.children) {
    d._children = d.children;
    d.children = null;
  } else {
    d.children = d._children;
    d._children = null;
  }
  update();
}

// Toggle children.
function toggle(d) {
  if (d.children) {
    d._children = d.children;
    d.children = null;
  } else {
    d.children = d._children;
    d._children = null;
  }
}



// Returns a list of all nodes under the root.
function flatten(root) {
  var nodes = [], i = 0;
	

  function recurse(node) {
    if (node.children) node.children.forEach(recurse);
    if (!node.id) node.id = ++i;
    nodes.push(node);
  }
  
//window.addEventListener('resize', resize); 

//function resize() {
//    width = window.innerWidth, height = window.innerHeight;
//    svg.attr("width", width).attr("height", height);
//    force.size([width, height]).resume();
//}

  recurse(root);
  return nodes;
}


//window.addEventListener('resize', resize); 

   



</script>
